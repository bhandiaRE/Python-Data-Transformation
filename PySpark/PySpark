{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/bhandiaRE/Python-Web-Scraping-/blob/main/PySpark.ipynb\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "!pip3 install pyspark"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "rKYWekMEbVuo",
        "outputId": "e791b176-9b5c-4578-ec27-742286aaaee3"
      },
      "execution_count": 4,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n",
            "Collecting pyspark\n",
            "  Downloading pyspark-3.3.1.tar.gz (281.4 MB)\n",
            "\u001b[K     |████████████████████████████████| 281.4 MB 44 kB/s \n",
            "\u001b[?25hCollecting py4j==0.10.9.5\n",
            "  Downloading py4j-0.10.9.5-py2.py3-none-any.whl (199 kB)\n",
            "\u001b[K     |████████████████████████████████| 199 kB 62.2 MB/s \n",
            "\u001b[?25hBuilding wheels for collected packages: pyspark\n",
            "  Building wheel for pyspark (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
            "  Created wheel for pyspark: filename=pyspark-3.3.1-py2.py3-none-any.whl size=281845512 sha256=fc5bfb3b1df3d30bc5a317c768a523e5588223ac7539f88722fc758a9e3b7238\n",
            "  Stored in directory: /root/.cache/pip/wheels/43/dc/11/ec201cd671da62fa9c5cc77078235e40722170ceba231d7598\n",
            "Successfully built pyspark\n",
            "Installing collected packages: py4j, pyspark\n",
            "Successfully installed py4j-0.10.9.5 pyspark-3.3.1\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "from pyspark import SparkContext, SparkConf\n",
        "\n",
        "conf = SparkConf().setAppName(\"Pyspark_Log\").setMaster(\"local[*]\")\n",
        "sc = SparkContext(conf=conf)\n",
        "print(sc)\n",
        "print(\"ready to go\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "CUGFUzqvcDUK",
        "outputId": "c0ea02a9-5f06-4083-81d5-347bd3a681a7"
      },
      "execution_count": 5,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "<SparkContext master=local[*] appName=Pyspark_Log>\n",
            "ready to go\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "from google.colab import drive\n",
        "drive.mount('/content/drive')"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "_FPwkIl8cyAm",
        "outputId": "c08df407-2fe0-46e0-d2e2-5d6be703adfd"
      },
      "execution_count": 6,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Mounted at /content/drive\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "rdd = sc.textFile(\"/content/drive/MyDrive/log.txt\")"
      ],
      "metadata": {
        "id": "qoF_S0gKfd9R"
      },
      "execution_count": 7,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "rdd = rdd.repartition(4)\n",
        "print(sc.defaultParallelism)\n",
        "print(rdd.getNumPartitions())"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "254CmLTJgwky",
        "outputId": "d43fe528-a0c0-4b93-df18-625f200fe597"
      },
      "execution_count": 8,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "2\n",
            "4\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "print(\"The number of records is\",rdd.count())\n",
        "rdd.takeSample(False, 30, 1234)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "Kn9j3D6KhZHQ",
        "outputId": "41d3ba73-d341-41a0-8e80-02a686758b11"
      },
      "execution_count": 9,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The number of recods is 62\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "['03/22 08:51:01 INFO   :...locate_configFile: Specified configuration file: /u/user10/rsvpd1.conf',\n",
              " '03/22 08:51:06 TRACE  :..entity_initialize: interface 9.37.65.139, entity for rsvp allocated and ',\n",
              " '03/22 08:51:06 TRACE  :..entity_initialize: interface 9.67.117.98, entity for rsvp allocated and ',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :...mailbox_register: mailbox allocated for timer',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp',\n",
              " '03/22 08:51:06 TRACE  :..entity_initialize: interface 9.67.100.1, entity for rsvp allocated and initialized',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #6, interface LOOPBACK has address 127.0.0.1, ifidx 0',\n",
              " '03/22 08:51:06 TRACE  :...read_physical_netif: Home list entries returned = 7',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #0, interface VLINK1 has address 129.1.1.1, ifidx 0',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " ' 05 ',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 TRACE  :..entity_initialize: interface 9.67.116.98, entity for rsvp allocated and ',\n",
              " '',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #4, interface CTCD0 has address 9.67.116.98, ifidx 4',\n",
              " 'initialized',\n",
              " '03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " 'initialized',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP',\n",
              " ' 06 ',\n",
              " '03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP']"
            ]
          },
          "metadata": {},
          "execution_count": 9
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "**Lines that have UDP**"
      ],
      "metadata": {
        "id": "FGJniqKrjur1"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "import re\n",
        "def collect_word(line):\n",
        "  return re.compile('\\w+').findall(line.lower())\n",
        "\n",
        "print(collect_word('we are TESTING !  ? oK?'))"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "4oyXbBDTiWJ6",
        "outputId": "5a8c1781-9d60-4520-9239-537eb4a483df"
      },
      "execution_count": 10,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "['we', 'are', 'testing', 'ok']\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "rdd_UDP = rdd.filter(lambda line: \"udp\" in collect_word(line))\n",
        "\n",
        "rdd_UDP.collect()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "gjAM2SVMpQBR",
        "outputId": "479c9338-a277-4424-f55d-5fc2da5a4758"
      },
      "execution_count": 11,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "['03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp',\n",
              " '03/22 08:51:06 INFO   :.....mailslot_create: creating mailslot for RSVP via UDP',\n",
              " '03/22 08:51:06 INFO   :....mailbox_register: mailbox allocated for rsvp-udp']"
            ]
          },
          "metadata": {},
          "execution_count": 11
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "**Get lines with IP Address and INFO**"
      ],
      "metadata": {
        "id": "tssGvuAqAPsq"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "def get_IP(line):\n",
        "  return re.findall(r'[0-9]+.[0-9]+.[0-9]+.[0-9]+.', line)\n",
        "\n",
        "get_IP('read_physical_netif: index #6, interface LOOPBACK has address 127.0.0.1, ifidx 0')"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "4T8P7Rh3AmlA",
        "outputId": "92239a0d-8b90-4de8-e9b8-5f6b8428b442"
      },
      "execution_count": 12,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "['127.0.0.1,']"
            ]
          },
          "metadata": {},
          "execution_count": 12
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "#rdd.filter(lambda line: line.split(',')[0])\\\n",
        "rdd.filter(lambda line: \"info\" in collect_word(line))\\\n",
        "  .filter(lambda line: len(get_IP(line))>1).collect()\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "NArIj1mEJgLJ",
        "outputId": "1805135a-3a24-413b-db86-aa08ca45cb89"
      },
      "execution_count": 13,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "['03/22 08:51:06 INFO   :...read_physical_netif: index #0, interface VLINK1 has address 129.1.1.1, ifidx 0',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #1, interface TR1 has address 9.37.65.139, ifidx 1',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #2, interface LINK11 has address 9.67.100.1, ifidx 2',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #3, interface LINK12 has address 9.67.101.1, ifidx 3',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #4, interface CTCD0 has address 9.67.116.98, ifidx 4',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #5, interface CTCD2 has address 9.67.117.98, ifidx 5',\n",
              " '03/22 08:51:06 INFO   :...read_physical_netif: index #6, interface LOOPBACK has address 127.0.0.1, ifidx 0']"
            ]
          },
          "metadata": {},
          "execution_count": 13
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "**Finding ifidx Connections**"
      ],
      "metadata": {
        "id": "aL9v3woNRieH"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "rdd_Failed = rdd.filter(lambda line: \"ifidx\" in collect_word(line))\n",
        "\n",
        "rdd_split = rdd_Failed.map(lambda line: (line.split()[12], 1))\n",
        "\n",
        "rdd_split.groupByKey(4).mapValues(sum).sortBy(lambda x: x[1], ascending=False).take(5)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "c6K3MwM-TQsx",
        "outputId": "c8fad244-e245-421d-a392-4fc36890440c"
      },
      "execution_count": 17,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "[('0', 2), ('4', 1), ('3', 1), ('1', 1), ('2', 1)]"
            ]
          },
          "metadata": {},
          "execution_count": 17
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [],
      "metadata": {
        "id": "enBWUnJ05RTA"
      },
      "execution_count": null,
      "outputs": []
    }
  ],
  "metadata": {
    "colab": {
      "name": "Welcome To Colaboratory",
      "provenance": [],
      "include_colab_link": true
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}
